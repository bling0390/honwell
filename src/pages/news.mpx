<template>
  <view class="news-page">
    <view class="header-section">
      <text class="page-title">‰ºÅ‰∏öËµÑËÆØ</text>
      <text class="page-subtitle">‰∫ÜËß£ÊúÄÊñ∞Âä®ÊÄÅÂíåË°å‰∏öË∂ãÂäø</text>
    </view>

    <view class="category-tabs">
      <view 
        wx:for="{{categories}}" 
        wx:key="id"
        class="tab-item {{currentCategory === item.id ? 'active' : ''}}"
        bindtap="switchCategory"
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>

    <view class="news-content">
      <view wx:if="{{filteredNews.length > 0}}" class="news-list">
        <view 
          wx:for="{{filteredNews}}" 
          wx:key="id"
          class="news-item"
          bindtap="viewNews"
          data-id="{{item.id}}"
        >
          <image class="news-image" src="{{item.image}}" mode="aspectFill" />
          <view class="news-info">
            <text class="news-title">{{item.title}}</text>
            <text class="news-summary">{{item.summary}}</text>
            <view class="news-meta">
              <text class="news-category">{{item.categoryName}}</text>
              <text class="news-date">{{item.publishDate}}</text>
            </view>
            <view class="news-stats">
              <view class="stat-item">
                <image class="stat-icon" src="https://via.placeholder.com/28x28/cccccc/666666?text=üëÅ" />
                <text class="stat-text">{{item.views}}</text>
              </view>
              <view class="stat-item">
                <image class="stat-icon" src="https://via.placeholder.com/28x28/cccccc/666666?text=üëç" />
                <text class="stat-text">{{item.likes}}</text>
              </view>
            </view>
          </view>
          <view wx:if="{{item.isTop}}" class="top-badge">ÁΩÆÈ°∂</view>
        </view>
      </view>

      <view wx:else class="empty-state">
        <image class="empty-icon" src="https://via.placeholder.com/120x120/cccccc/666666?text=Empty" />
        <text class="empty-text">ÊöÇÊó†Áõ∏ÂÖ≥ËµÑËÆØ</text>
      </view>
    </view>

    <view class="load-more" wx:if="{{hasMore && filteredNews.length > 0}}">
      <button class="load-more-btn" bindtap="loadMore">
        {{loading ? 'Âä†ËΩΩ‰∏≠...' : 'Âä†ËΩΩÊõ¥Â§ö'}}
      </button>
    </view>
  </view>
</template>

<script lang="ts">
import { createPage } from '@mpxjs/core'

interface Category {
  id: number
  name: string
}

interface NewsItem {
  id: number
  title: string
  summary: string
  content: string
  image: string
  categoryId: number
  categoryName: string
  publishDate: string
  views: number
  likes: number
  isTop: boolean
  tags: string[]
}

createPage({
  data: {
    currentCategory: 0,
    loading: false,
    hasMore: true,
    page: 1,
    
    categories: [
      { id: 0, name: 'ÂÖ®ÈÉ®' },
      { id: 1, name: 'ÂÖ¨Âè∏Êñ∞Èóª' },
      { id: 2, name: 'Ë°å‰∏öÂä®ÊÄÅ' },
      { id: 3, name: '‰∫ßÂìÅÊõ¥Êñ∞' },
      { id: 4, name: 'ÊäÄÊúØÂàÜ‰∫´' }
    ] as Category[],

    newsList: [
      {
        id: 1,
        title: 'ÂÖ¨Âè∏ÊàêÂäüËé∑ÂæóISO 9001Ë¥®ÈáèÁÆ°ÁêÜ‰ΩìÁ≥ªËÆ§ËØÅ',
        summary: 'ÁªèËøá‰∏•Ê†ºÁöÑÂÆ°Ê†∏ÊµÅÁ®ãÔºåÊàë‰ª¨Ê≠£ÂºèËé∑ÂæóISO 9001:2015Ë¥®ÈáèÁÆ°ÁêÜ‰ΩìÁ≥ªËÆ§ËØÅÔºåÊ†áÂøóÁùÄÂÖ¨Âè∏Âú®Ë¥®ÈáèÁÆ°ÁêÜÊñπÈù¢ËææÂà∞ÂõΩÈôÖÊ†áÂáÜ„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=ISO+Certification',
        categoryId: 1,
        categoryName: 'ÂÖ¨Âè∏Êñ∞Èóª',
        publishDate: '2024-01-15',
        views: 1203,
        likes: 45,
        isTop: true,
        tags: ['ËÆ§ËØÅ', 'Ë¥®ÈáèÁÆ°ÁêÜ', 'ISO']
      },
      {
        id: 2,
        title: 'Êô∫ËÉΩÂà∂ÈÄ†Ë°å‰∏öËøéÊù•Êñ∞ÁöÑÂèëÂ±ïÊú∫ÈÅá',
        summary: 'ÈöèÁùÄÊï∞Â≠óÂåñËΩ¨ÂûãÁöÑÊ∑±ÂÖ•Êé®ËøõÔºåÊô∫ËÉΩÂà∂ÈÄ†Ë°å‰∏öÊ≠£ËøéÊù•ÂâçÊâÄÊú™ÊúâÁöÑÂèëÂ±ïÊú∫ÈÅáÔºåÈ¢ÑËÆ°Êú™Êù•‰∏âÂπ¥Â∏ÇÂú∫ËßÑÊ®°Â∞ÜÁøªÂÄçÂ¢ûÈïø„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=Smart+Manufacturing',
        categoryId: 2,
        categoryName: 'Ë°å‰∏öÂä®ÊÄÅ',
        publishDate: '2024-01-12',
        views: 892,
        likes: 32,
        isTop: false,
        tags: ['Êô∫ËÉΩÂà∂ÈÄ†', 'Êï∞Â≠óÂåñ', 'Â∏ÇÂú∫Ë∂ãÂäø']
      },
      {
        id: 3,
        title: '‰∫ßÂìÅÁÆ°ÁêÜÂπ≥Âè∞ v3.0 ÈáçÂ§ßÊõ¥Êñ∞ÂèëÂ∏É',
        summary: 'ÂÖ®Êñ∞ÁöÑ‰∫ßÂìÅÁÆ°ÁêÜÂπ≥Âè∞Â∏¶Êù•‰∫ÜÊõ¥Âº∫Â§ßÁöÑÂäüËÉΩÂíåÊõ¥‰ºòÁßÄÁöÑÁî®Êà∑‰ΩìÈ™åÔºåÂåÖÊã¨AIÊô∫ËÉΩÂàÜÊûê„ÄÅÂÆûÊó∂Âçè‰ΩúÁ≠âÊ†∏ÂøÉÁâπÊÄß„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=Platform+Update',
        categoryId: 3,
        categoryName: '‰∫ßÂìÅÊõ¥Êñ∞',
        publishDate: '2024-01-10',
        views: 756,
        likes: 28,
        isTop: false,
        tags: ['‰∫ßÂìÅÊõ¥Êñ∞', 'v3.0', 'AI', 'Âçè‰Ωú']
      },
      {
        id: 4,
        title: 'Â¶Ç‰ΩïÂú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÂÆûÁé∞È´òÂèØÁî®ÊÄß',
        summary: 'ÂàÜ‰∫´Âú®ÂæÆÊúçÂä°Êû∂ÊûÑËÆæËÆ°‰∏≠ÂÆûÁé∞È´òÂèØÁî®ÊÄßÁöÑÊúÄ‰Ω≥ÂÆûË∑µÔºåÂåÖÊã¨ÊúçÂä°ÂèëÁé∞„ÄÅË¥üËΩΩÂùáË°°„ÄÅÁÜîÊñ≠Âô®Á≠âÂÖ≥ÈîÆÊäÄÊúØ„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=Microservices',
        categoryId: 4,
        categoryName: 'ÊäÄÊúØÂàÜ‰∫´',
        publishDate: '2024-01-08',
        views: 654,
        likes: 41,
        isTop: false,
        tags: ['ÂæÆÊúçÂä°', 'È´òÂèØÁî®', 'Êû∂ÊûÑËÆæËÆ°']
      },
      {
        id: 5,
        title: 'ÂÖ¨Âè∏ÂèÇÂä†2024Âπ¥ÁßëÊäÄÂàõÊñ∞Â±ïËßà‰ºöËé∑ÂæóÂ•ΩËØÑ',
        summary: 'Âú®‰ªäÂπ¥ÁöÑÁßëÊäÄÂàõÊñ∞Â±ïËßà‰ºö‰∏äÔºåÊàë‰ª¨Â±ïÁ§∫ÁöÑÊúÄÊñ∞ÊäÄÊúØËß£ÂÜ≥ÊñπÊ°àËé∑Âæó‰∫ÜÂèÇËßÇËÄÖÂíå‰∏ìÂÆ∂ÁöÑ‰∏ÄËá¥Â•ΩËØÑ„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=Tech+Exhibition',
        categoryId: 1,
        categoryName: 'ÂÖ¨Âè∏Êñ∞Èóª',
        publishDate: '2024-01-05',
        views: 523,
        likes: 19,
        isTop: false,
        tags: ['Â±ïËßà‰ºö', 'ÂàõÊñ∞', 'ÊäÄÊúØÂ±ïÁ§∫']
      },
      {
        id: 6,
        title: 'AIÊäÄÊúØÂú®Â∑•‰∏öÁâ©ËÅîÁΩë‰∏≠ÁöÑÂ∫îÁî®ÂâçÊôØ',
        summary: 'Êé¢ËÆ®‰∫∫Â∑•Êô∫ËÉΩÊäÄÊúØÂú®Â∑•‰∏öÁâ©ËÅîÁΩëÈ¢ÜÂüüÁöÑÂ∫îÁî®Áé∞Áä∂ÂíåÊú™Êù•ÂèëÂ±ïË∂ãÂäøÔºå‰ª•ÂèäÂØπ‰º†ÁªüÂà∂ÈÄ†‰∏öÁöÑÂèòÈù©ÊÑè‰πâ„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=AI+IoT',
        categoryId: 2,
        categoryName: 'Ë°å‰∏öÂä®ÊÄÅ',
        publishDate: '2024-01-03',
        views: 445,
        likes: 23,
        isTop: false,
        tags: ['AI', 'Áâ©ËÅîÁΩë', 'Â∑•‰∏ö4.0']
      },
      {
        id: 7,
        title: '‰∫ëÂÆâÂÖ®ÊúçÂä°Êñ∞ÂäüËÉΩ‰∏äÁ∫øÂÖ¨Âëä',
        summary: 'Êàë‰ª¨ÁöÑ‰∫ëÂÆâÂÖ®ÊúçÂä°Êñ∞Â¢û‰∫ÜÂ®ÅËÉÅÊÉÖÊä•ÂàÜÊûêÂíåËá™Âä®ÂåñÂìçÂ∫îÂäüËÉΩÔºå‰∏∫Áî®Êà∑Êèê‰æõÊõ¥ÂÖ®Èù¢ÁöÑÂÆâÂÖ®Èò≤Êä§„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=Cloud+Security',
        categoryId: 3,
        categoryName: '‰∫ßÂìÅÊõ¥Êñ∞',
        publishDate: '2024-01-01',
        views: 378,
        likes: 15,
        isTop: false,
        tags: ['‰∫ëÂÆâÂÖ®', 'Â®ÅËÉÅÊÉÖÊä•', 'Ëá™Âä®Âåñ']
      },
      {
        id: 8,
        title: 'ÂÆπÂô®ÂåñÈÉ®ÁΩ≤ÁöÑÊÄßËÉΩ‰ºòÂåñÂÆûË∑µ',
        summary: 'ÂàÜ‰∫´Êàë‰ª¨Âú®ÂÆπÂô®ÂåñÈÉ®ÁΩ≤ËøáÁ®ã‰∏≠ÁöÑÊÄßËÉΩ‰ºòÂåñÁªèÈ™åÔºåÂåÖÊã¨ËµÑÊ∫êÈÖçÁΩÆ„ÄÅÁΩëÁªú‰ºòÂåñ„ÄÅÂ≠òÂÇ®‰ºòÂåñÁ≠âÊñπÈù¢„ÄÇ',
        content: '',
        image: 'https://via.placeholder.com/600x300/667eea/ffffff?text=Container+Optimization',
        categoryId: 4,
        categoryName: 'ÊäÄÊúØÂàÜ‰∫´',
        publishDate: '2023-12-28',
        views: 612,
        likes: 37,
        isTop: false,
        tags: ['ÂÆπÂô®Âåñ', 'ÊÄßËÉΩ‰ºòÂåñ', 'Docker']
      }
    ] as NewsItem[],

    filteredNews: [] as NewsItem[]
  },

  onLoad() {
    wx.setNavigationBarTitle({
      title: '‰ºÅ‰∏öËµÑËÆØ'
    })
    this.filterNews(0)
  },

  onShow() {
    if (typeof this.getTabBar === 'function' && this.getTabBar()) {
      this.getTabBar().setData({
        selected: 2
      })
    }
  },

  onPullDownRefresh() {
    this.setData({
      page: 1,
      hasMore: true
    })
    this.filterNews(this.data.currentCategory)
    wx.stopPullDownRefresh()
  },

  switchCategory(event: any) {
    const categoryId = event.target.dataset.category
    this.setData({
      currentCategory: categoryId,
      page: 1,
      hasMore: true
    })
    this.filterNews(categoryId)
  },

  filterNews(categoryId: number) {
    let filtered = categoryId === 0 
      ? this.data.newsList 
      : this.data.newsList.filter(news => news.categoryId === categoryId)
    
    // ÁΩÆÈ°∂ÊñáÁ´†ÊéíÂ∫è
    filtered.sort((a, b) => {
      if (a.isTop && !b.isTop) return -1
      if (!a.isTop && b.isTop) return 1
      return new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime()
    })

    this.setData({
      filteredNews: filtered
    })
  },

  viewNews() {
    wx.showToast({
      title: 'ÊñáÁ´†ËØ¶ÊÉÖÂºÄÂèë‰∏≠',
      icon: 'none'
    })
  },

  loadMore() {
    if (this.data.loading || !this.data.hasMore) return
    
    this.setData({ loading: true })
    
    // Ê®°ÊãüÂä†ËΩΩÊõ¥Â§öÊï∞ÊçÆ
    setTimeout(() => {
      this.setData({
        loading: false,
        hasMore: false // ÊºîÁ§∫Áî®ÔºåÂÆûÈôÖÂ∫îÊ†πÊçÆÊï∞ÊçÆÂà§Êñ≠
      })
    }, 1000)
  }
})
</script>

<style lang="stylus">
.news-page
  background-color #f5f5f5
  min-height 100vh
  padding-bottom calc(100rpx + env(safe-area-inset-bottom) + 20rpx)

.header-section
  background linear-gradient(135deg, #f093fb 0%, #f5576c 100%)
  padding 60rpx 30rpx 40rpx
  color white
  text-align center

.page-title
  font-size 48rpx
  font-weight bold
  margin-bottom 16rpx
  display block

.page-subtitle
  font-size 28rpx
  opacity 0.9
  display block

.category-tabs
  background white
  padding 0 30rpx
  display flex
  border-bottom 1px solid #eee

.tab-item
  flex 1
  text-align center
  padding 30rpx 0
  font-size 28rpx
  color #666
  position relative

.tab-item.active
  color #007aff
  font-weight bold

.tab-item.active::after
  content ''
  position absolute
  bottom 0
  left 50%
  transform translateX(-50%)
  width 60rpx
  height 4rpx
  background #007aff
  border-radius 2rpx

.news-content
  padding 30rpx

.news-list
  display flex
  flex-direction column
  gap 30rpx

.news-item
  background white
  border-radius 16rpx
  overflow hidden
  box-shadow 0 4rpx 20rpx rgba(0, 0, 0, 0.06)
  position relative
  transition transform 0.3s ease

.news-item:active
  transform scale(0.98)

.news-image
  width 100%
  height 300rpx
  object-fit cover

.news-info
  padding 30rpx

.news-title
  font-size 32rpx
  font-weight bold
  color #333
  margin-bottom 16rpx
  display block
  line-height 1.4

.news-summary
  font-size 26rpx
  color #666
  line-height 1.6
  margin-bottom 20rpx
  display block
  -webkit-line-clamp 2
  -webkit-box-orient vertical
  overflow hidden
  text-overflow ellipsis
  display -webkit-box

.news-meta
  display flex
  justify-content space-between
  align-items center
  margin-bottom 20rpx

.news-category
  background rgba(0, 122, 255, 0.1)
  color #007aff
  padding 8rpx 16rpx
  border-radius 12rpx
  font-size 22rpx

.news-date
  font-size 24rpx
  color #999

.news-stats
  display flex
  gap 30rpx

.stat-item
  display flex
  align-items center
  gap 8rpx

.stat-icon
  width 28rpx
  height 28rpx
  opacity 0.6

.stat-text
  font-size 24rpx
  color #999

.top-badge
  position absolute
  top 20rpx
  right 20rpx
  background linear-gradient(45deg, #ff6b6b, #ee5a24)
  color white
  padding 8rpx 16rpx
  border-radius 0 16rpx 0 16rpx
  font-size 20rpx
  font-weight bold

.empty-state
  display flex
  flex-direction column
  align-items center
  padding 80rpx 30rpx
  background white
  border-radius 16rpx

.empty-icon
  width 120rpx
  height 120rpx
  margin-bottom 30rpx
  opacity 0.3

.empty-text
  font-size 28rpx
  color #999

.load-more
  padding 30rpx 30rpx 20rpx

.load-more-btn
  width 100%
  background white
  color #007aff
  border 1px solid #007aff
  border-radius 50rpx
  padding 24rpx
  font-size 28rpx

.load-more-btn::after
  border none

.load-more-btn[disabled]
  background #f5f5f5
  color #999
  border-color #e5e5e5
</style>

<script type="application/json">
{
  "navigationBarTitleText": "‰ºÅ‰∏öËµÑËÆØ",
  "enablePullDownRefresh": true
}
</script>