<template>
  <view class="news-page">
    <view class="header-section">
      <text class="page-title">ä¼ä¸šèµ„è®¯</text>
      <text class="page-subtitle">äº†è§£æœ€æ–°åŠ¨æ€å’Œè¡Œä¸šè¶‹åŠ¿</text>
    </view>

    <view class="category-tabs">
      <view 
        wx:for="{{categories}}" 
        wx:key="id"
        class="tab-item {{currentCategory === item.id ? 'active' : ''}}"
        bindtap="switchCategory"
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>

    <view class="news-content">
      <view wx:if="{{filteredNews.length > 0}}" class="news-list">
        <view 
          wx:for="{{filteredNews}}" 
          wx:key="id"
          class="news-item"
          bindtap="viewNews"
          data-id="{{item.id}}"
        >
          <view class="news-image">
            <text class="news-icon">{{item.iconText}}</text>
          </view>
          <view class="news-info">
            <text class="news-title">{{item.title}}</text>
            <text class="news-summary">{{item.summary}}</text>
            <view class="news-meta">
              <text class="news-category">{{item.categoryName}}</text>
              <text class="news-date">{{item.publishDate}}</text>
            </view>
            <view class="news-stats">
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘</text>
                <text class="stat-text">{{item.views}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘</text>
                <text class="stat-text">{{item.likes}}</text>
              </view>
            </view>
          </view>
          <view wx:if="{{item.isTop}}" class="top-badge">ç½®é¡¶</view>
        </view>
      </view>

      <view wx:else class="empty-state">
        <text class="empty-icon">ğŸ“„</text>
        <text class="empty-text">æš‚æ— ç›¸å…³èµ„è®¯</text>
      </view>
    </view>

    <view class="load-more" wx:if="{{hasMore && filteredNews.length > 0}}">
      <button class="load-more-btn" bindtap="loadMore">
        {{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
      </button>
    </view>
  </view>
</template>

<script lang="ts">
import { createPage } from '@mpxjs/core'

interface Category {
  id: number
  name: string
}

interface NewsItem {
  id: number
  title: string
  summary: string
  content: string
  iconText: string
  categoryId: number
  categoryName: string
  publishDate: string
  views: number
  likes: number
  isTop: boolean
  tags: string[]
}

createPage({
  data: {
    currentCategory: 0,
    loading: false,
    hasMore: true,
    page: 1,
    
    categories: [
      { id: 0, name: 'å…¨éƒ¨' },
      { id: 1, name: 'å…¬å¸æ–°é—»' },
      { id: 2, name: 'è¡Œä¸šåŠ¨æ€' },
      { id: 3, name: 'äº§å“æ›´æ–°' },
      { id: 4, name: 'æŠ€æœ¯åˆ†äº«' }
    ] as Category[],

    newsList: [
      {
        id: 1,
        title: 'å…¬å¸æˆåŠŸè·å¾—ISO 9001è´¨é‡ç®¡ç†ä½“ç³»è®¤è¯',
        summary: 'ç»è¿‡ä¸¥æ ¼çš„å®¡æ ¸æµç¨‹ï¼Œæˆ‘ä»¬æ­£å¼è·å¾—ISO 9001:2015è´¨é‡ç®¡ç†ä½“ç³»è®¤è¯ï¼Œæ ‡å¿—ç€å…¬å¸åœ¨è´¨é‡ç®¡ç†æ–¹é¢è¾¾åˆ°å›½é™…æ ‡å‡†ã€‚',
        content: '',
iconText: 'ğŸ†',
        categoryId: 1,
        categoryName: 'å…¬å¸æ–°é—»',
        publishDate: '2024-01-15',
        views: 1203,
        likes: 45,
        isTop: true,
        tags: ['è®¤è¯', 'è´¨é‡ç®¡ç†', 'ISO']
      },
      {
        id: 2,
        title: 'æ™ºèƒ½åˆ¶é€ è¡Œä¸šè¿æ¥æ–°çš„å‘å±•æœºé‡',
        summary: 'éšç€æ•°å­—åŒ–è½¬å‹çš„æ·±å…¥æ¨è¿›ï¼Œæ™ºèƒ½åˆ¶é€ è¡Œä¸šæ­£è¿æ¥å‰æ‰€æœªæœ‰çš„å‘å±•æœºé‡ï¼Œé¢„è®¡æœªæ¥ä¸‰å¹´å¸‚åœºè§„æ¨¡å°†ç¿»å€å¢é•¿ã€‚',
        content: '',
iconText: 'ğŸ­',
        categoryId: 2,
        categoryName: 'è¡Œä¸šåŠ¨æ€',
        publishDate: '2024-01-12',
        views: 892,
        likes: 32,
        isTop: false,
        tags: ['æ™ºèƒ½åˆ¶é€ ', 'æ•°å­—åŒ–', 'å¸‚åœºè¶‹åŠ¿']
      },
      {
        id: 3,
        title: 'äº§å“ç®¡ç†å¹³å° v3.0 é‡å¤§æ›´æ–°å‘å¸ƒ',
        summary: 'å…¨æ–°çš„äº§å“ç®¡ç†å¹³å°å¸¦æ¥äº†æ›´å¼ºå¤§çš„åŠŸèƒ½å’Œæ›´ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒï¼ŒåŒ…æ‹¬AIæ™ºèƒ½åˆ†æã€å®æ—¶åä½œç­‰æ ¸å¿ƒç‰¹æ€§ã€‚',
        content: '',
iconText: 'ğŸ”„',
        categoryId: 3,
        categoryName: 'äº§å“æ›´æ–°',
        publishDate: '2024-01-10',
        views: 756,
        likes: 28,
        isTop: false,
        tags: ['äº§å“æ›´æ–°', 'v3.0', 'AI', 'åä½œ']
      },
      {
        id: 4,
        title: 'å¦‚ä½•åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å®ç°é«˜å¯ç”¨æ€§',
        summary: 'åˆ†äº«åœ¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¸­å®ç°é«˜å¯ç”¨æ€§çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­å™¨ç­‰å…³é”®æŠ€æœ¯ã€‚',
        content: '',
iconText: 'ğŸ”§',
        categoryId: 4,
        categoryName: 'æŠ€æœ¯åˆ†äº«',
        publishDate: '2024-01-08',
        views: 654,
        likes: 41,
        isTop: false,
        tags: ['å¾®æœåŠ¡', 'é«˜å¯ç”¨', 'æ¶æ„è®¾è®¡']
      },
      {
        id: 5,
        title: 'å…¬å¸å‚åŠ 2024å¹´ç§‘æŠ€åˆ›æ–°å±•è§ˆä¼šè·å¾—å¥½è¯„',
        summary: 'åœ¨ä»Šå¹´çš„ç§‘æŠ€åˆ›æ–°å±•è§ˆä¼šä¸Šï¼Œæˆ‘ä»¬å±•ç¤ºçš„æœ€æ–°æŠ€æœ¯è§£å†³æ–¹æ¡ˆè·å¾—äº†å‚è§‚è€…å’Œä¸“å®¶çš„ä¸€è‡´å¥½è¯„ã€‚',
        content: '',
iconText: 'ğŸ–¼ï¸',
        categoryId: 1,
        categoryName: 'å…¬å¸æ–°é—»',
        publishDate: '2024-01-05',
        views: 523,
        likes: 19,
        isTop: false,
        tags: ['å±•è§ˆä¼š', 'åˆ›æ–°', 'æŠ€æœ¯å±•ç¤º']
      },
      {
        id: 6,
        title: 'AIæŠ€æœ¯åœ¨å·¥ä¸šç‰©è”ç½‘ä¸­çš„åº”ç”¨å‰æ™¯',
        summary: 'æ¢è®¨äººå·¥æ™ºèƒ½æŠ€æœ¯åœ¨å·¥ä¸šç‰©è”ç½‘é¢†åŸŸçš„åº”ç”¨ç°çŠ¶å’Œæœªæ¥å‘å±•è¶‹åŠ¿ï¼Œä»¥åŠå¯¹ä¼ ç»Ÿåˆ¶é€ ä¸šçš„å˜é©æ„ä¹‰ã€‚',
        content: '',
iconText: 'ğŸ¤–',
        categoryId: 2,
        categoryName: 'è¡Œä¸šåŠ¨æ€',
        publishDate: '2024-01-03',
        views: 445,
        likes: 23,
        isTop: false,
        tags: ['AI', 'ç‰©è”ç½‘', 'å·¥ä¸š4.0']
      },
      {
        id: 7,
        title: 'äº‘å®‰å…¨æœåŠ¡æ–°åŠŸèƒ½ä¸Šçº¿å…¬å‘Š',
        summary: 'æˆ‘ä»¬çš„äº‘å®‰å…¨æœåŠ¡æ–°å¢äº†å¨èƒæƒ…æŠ¥åˆ†æå’Œè‡ªåŠ¨åŒ–å“åº”åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å…¨é¢çš„å®‰å…¨é˜²æŠ¤ã€‚',
        content: '',
iconText: 'ğŸ›¡ï¸',
        categoryId: 3,
        categoryName: 'äº§å“æ›´æ–°',
        publishDate: '2024-01-01',
        views: 378,
        likes: 15,
        isTop: false,
        tags: ['äº‘å®‰å…¨', 'å¨èƒæƒ…æŠ¥', 'è‡ªåŠ¨åŒ–']
      },
      {
        id: 8,
        title: 'å®¹å™¨åŒ–éƒ¨ç½²çš„æ€§èƒ½ä¼˜åŒ–å®è·µ',
        summary: 'åˆ†äº«æˆ‘ä»¬åœ¨å®¹å™¨åŒ–éƒ¨ç½²è¿‡ç¨‹ä¸­çš„æ€§èƒ½ä¼˜åŒ–ç»éªŒï¼ŒåŒ…æ‹¬èµ„æºé…ç½®ã€ç½‘ç»œä¼˜åŒ–ã€å­˜å‚¨ä¼˜åŒ–ç­‰æ–¹é¢ã€‚',
        content: '',
iconText: 'ğŸ“¦',
        categoryId: 4,
        categoryName: 'æŠ€æœ¯åˆ†äº«',
        publishDate: '2023-12-28',
        views: 612,
        likes: 37,
        isTop: false,
        tags: ['å®¹å™¨åŒ–', 'æ€§èƒ½ä¼˜åŒ–', 'Docker']
      }
    ] as NewsItem[],

    filteredNews: [] as NewsItem[]
  },

  onLoad() {
    wx.setNavigationBarTitle({
      title: 'ä¼ä¸šèµ„è®¯'
    })
    this.filterNews(0)
  },

  onShow() {
    if (typeof this.getTabBar === 'function' && this.getTabBar()) {
      this.getTabBar().setData({
        selected: 2
      })
    }
  },

  onPullDownRefresh() {
    this.setData({
      page: 1,
      hasMore: true
    })
    this.filterNews(this.data.currentCategory)
    wx.stopPullDownRefresh()
  },

  switchCategory(event: any) {
    const categoryId = event.target.dataset.category
    this.setData({
      currentCategory: categoryId,
      page: 1,
      hasMore: true
    })
    this.filterNews(categoryId)
  },

  filterNews(categoryId: number) {
    let filtered = categoryId === 0 
      ? this.data.newsList 
      : this.data.newsList.filter(news => news.categoryId === categoryId)
    
    // ç½®é¡¶æ–‡ç« æ’åº
    filtered.sort((a, b) => {
      if (a.isTop && !b.isTop) return -1
      if (!a.isTop && b.isTop) return 1
      return new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime()
    })

    this.setData({
      filteredNews: filtered
    })
  },

  viewNews() {
    wx.showToast({
      title: 'æ–‡ç« è¯¦æƒ…å¼€å‘ä¸­',
      icon: 'none'
    })
  },

  loadMore() {
    if (this.data.loading || !this.data.hasMore) return
    
    this.setData({ loading: true })
    
    // æ¨¡æ‹ŸåŠ è½½æ›´å¤šæ•°æ®
    setTimeout(() => {
      this.setData({
        loading: false,
        hasMore: false // æ¼”ç¤ºç”¨ï¼Œå®é™…åº”æ ¹æ®æ•°æ®åˆ¤æ–­
      })
    }, 1000)
  }
})
</script>

<style lang="stylus">
.news-page
  background-color #f5f5f5
  min-height 100vh
  padding-bottom calc(100rpx + env(safe-area-inset-bottom) + 20rpx)

.header-section
  background linear-gradient(135deg, #f093fb 0%, #f5576c 100%)
  padding 60rpx 30rpx 40rpx
  color white
  text-align center

.page-title
  font-size 48rpx
  font-weight bold
  margin-bottom 16rpx
  display block

.page-subtitle
  font-size 28rpx
  opacity 0.9
  display block

.category-tabs
  background white
  padding 0 30rpx
  display flex
  border-bottom 1px solid #eee

.tab-item
  flex 1
  text-align center
  padding 30rpx 0
  font-size 28rpx
  color #666
  position relative

.tab-item.active
  color #007aff
  font-weight bold

.tab-item.active::after
  content ''
  position absolute
  bottom 0
  left 50%
  transform translateX(-50%)
  width 60rpx
  height 4rpx
  background #007aff
  border-radius 2rpx

.news-content
  padding 30rpx

.news-list
  display flex
  flex-direction column
  gap 30rpx

.news-item
  background white
  border-radius 16rpx
  overflow hidden
  box-shadow 0 4rpx 20rpx rgba(0, 0, 0, 0.06)
  position relative
  transition transform 0.3s ease

.news-item:active
  transform scale(0.98)

.news-image
  width 100%
  height 300rpx
  display flex
  justify-content center
  align-items center
  background linear-gradient(135deg, #f093fb 0%, #f5576c 100%)

.news-icon
  font-size 100rpx
  color white

.news-info
  padding 30rpx

.news-title
  font-size 32rpx
  font-weight bold
  color #333
  margin-bottom 16rpx
  display block
  line-height 1.4

.news-summary
  font-size 26rpx
  color #666
  line-height 1.6
  margin-bottom 20rpx
  display block
  -webkit-line-clamp 2
  -webkit-box-orient vertical
  overflow hidden
  text-overflow ellipsis
  display -webkit-box

.news-meta
  display flex
  justify-content space-between
  align-items center
  margin-bottom 20rpx

.news-category
  background rgba(0, 122, 255, 0.1)
  color #007aff
  padding 8rpx 16rpx
  border-radius 12rpx
  font-size 22rpx

.news-date
  font-size 24rpx
  color #999

.news-stats
  display flex
  gap 30rpx

.stat-item
  display flex
  align-items center
  gap 8rpx

.stat-icon
  font-size 28rpx
  opacity 0.6
  display block

.stat-text
  font-size 24rpx
  color #999

.top-badge
  position absolute
  top 20rpx
  right 20rpx
  background linear-gradient(45deg, #ff6b6b, #ee5a24)
  color white
  padding 8rpx 16rpx
  border-radius 0 16rpx 0 16rpx
  font-size 20rpx
  font-weight bold

.empty-state
  display flex
  flex-direction column
  align-items center
  padding 80rpx 30rpx
  background white
  border-radius 16rpx

.empty-icon
  font-size 120rpx
  margin-bottom 30rpx
  opacity 0.3
  display block

.empty-text
  font-size 28rpx
  color #999

.load-more
  padding 30rpx 30rpx 20rpx

.load-more-btn
  width 100%
  background white
  color #007aff
  border 1px solid #007aff
  border-radius 50rpx
  padding 24rpx
  font-size 28rpx

.load-more-btn::after
  border none

.load-more-btn[disabled]
  background #f5f5f5
  color #999
  border-color #e5e5e5
</style>

<script type="application/json">
{
  "navigationBarTitleText": "ä¼ä¸šèµ„è®¯",
  "enablePullDownRefresh": true
}
</script>